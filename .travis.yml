dist: bionic
sudo: required

language: scala

scala:
  - "2.12.1"

python:
  - "3.7"

jdk:
  - openjdk10

cache:
  directories:
    - "$HOME/.ivy2"
    - "$TRAVIS_BUILD_DIR/.cache"

services:
  - docker

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - wget
      - pkg-config
      - expect

before_install:
  - wget https://github.com/bazelbuild/bazel/releases/download/1.1.0/bazel_1.1.0-linux-x86_64.deb
  # - sha256sum -c tools/bazel_1.1.0-linux-x86_64.deb.sha256
  - sudo dpkg -i bazel_1.1.0-linux-x86_64.deb
  - echo "build --disk_cache=$TRAVIS_BUILD_DIR/.cache" >> .bazelrc

script:
  - git clone -b develop --single-branch --depth 1 https://github.com/dasch-swiss/knora-api.git
  - ls
  - cd $TRAVIS_BUILD_DIR/knora-api
  - export GDB_HEAP_SIZE=2G
  - make stack-up
  - sleep 15
  - make init-db-test-minimal-free
  - sleep 15
  - make stack-restart-api
  - cd $TRAVIS_BUILD_DIR
  - pyenv shell 3.7.1
  - bazel test //...
