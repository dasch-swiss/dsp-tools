@prefix sh:         <http://www.w3.org/ns/shacl#> .
@prefix rdfs:       <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:        <http://www.w3.org/2001/XMLSchema#> .
@prefix owl:        <http://www.w3.org/2002/07/owl#> .
@prefix dash:       <http://datashapes.org/dash#> .
@prefix knora-api:  <http://api.knora.org/ontology/knora-api/v2#> .

@prefix api-shapes: <http://api.knora.org/ontology/knora-api/shapes/v2#> .


api-shapes:rdfsLabel_Cardinality
  a           sh:PropertyShape ;
  sh:path     rdfs:label ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:severity sh:Violation ;
  sh:message  "A label is required" .


### knora-api:hasPermissions
api-shapes:hasPermissions_Cardinality
  a           sh:PropertyShape ;
  sh:path     knora-api:hasPermissions ;
  sh:minCount 0 ;
  sh:maxCount 1 ;
  sh:severity sh:Violation ;
  sh:message  "The resource or value may have at most one permission." .


#########################################
# DSP IN-BUILT RESOURCES
#########################################


###########################
# LinkObj

knora-api:LinkObj
  a                  sh:NodeShape ;
  dash:closedByTypes true ;
  sh:property        api-shapes:rdfsLabel_Cardinality ,
                     api-shapes:hasPermissions_Cardinality ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasComment
                     ],
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasLinkTo ;
                       sh:minCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1-n" ;
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasStandoffLinkTo
                     ] .

###########################
# Region

knora-api:Region
  a                  sh:NodeShape ;
  dash:closedByTypes true ;
  sh:property        api-shapes:rdfsLabel_Cardinality,
                     api-shapes:hasPermissions_Cardinality ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasComment
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasColor ;
                       sh:minCount 1 ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:isRegionOf ;
                       sh:minCount 1 ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasGeometry ;
                       sh:minCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1-n" ;
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasStandoffLinkTo
                     ] .


###########################
# AudioSegment

knora-api:AudioSegment
  a                  sh:NodeShape ;
  dash:closedByTypes true ;
  sh:property        api-shapes:rdfsLabel_Cardinality,
                     api-shapes:hasPermissions_Cardinality ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasSegmentBounds ;
                       sh:minCount 1 ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:isAudioSegmentOf ;
                       sh:minCount 1 ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasTitle ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 0-1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasKeyword
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasComment
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:relatesTo
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasDescription
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasStandoffLinkTo
                     ] .


###########################
# VideoSegment

knora-api:VideoSegment
  a                  sh:NodeShape ;
  dash:closedByTypes true ;
  sh:property        api-shapes:rdfsLabel_Cardinality,
                     api-shapes:hasPermissions_Cardinality ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasSegmentBounds ;
                       sh:minCount 1 ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:isVideoSegmentOf ;
                       sh:minCount 1 ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasTitle ;
                       sh:maxCount 1 ;
                       sh:severity sh:Violation ;
                       sh:message "Cardinality 0-1" ;
                     ] ,
                     [ a sh:PropertyShape ;
                       sh:path knora-api:hasKeyword
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasComment
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:relatesTo
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasDescription
                     ] ,
                     [
                       a sh:PropertyShape ;
                       sh:path knora-api:hasStandoffLinkTo
                     ] .


#########################################
# RESOURCES WITH FILES
#########################################

### Legal Info Properties
api-shapes:hasLicense_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasLicense ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:severity sh:Violation ;
  sh:message  "Files and IIIF-URIs require a reference to a license." .

api-shapes:hasAuthorship_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasAuthorship ;
  sh:datatype xsd:string ;
  sh:minCount 1 ;
  sh:severity sh:Violation ;
  sh:message  "Files and IIIF-URIs require at least one authorship." .

api-shapes:hasCopyrightHolder_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasCopyrightHolder ;
  sh:datatype xsd:string ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:severity sh:Violation ;
  sh:message  "Files and IIIF-URIs require a copyright holder." .


###########################
# ArchiveRepresentation
###########################

api-shapes:hasArchiveFileValue_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasArchiveFileValue ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:message  """
              An ArchiveRepresentation requires a file with one of the following extensions
              'zip', 'tar', 'gz', 'z', 'tgz', 'gzip', '7z'.
              """ .

api-shapes:ArchiveFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:ArchiveFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:fileValueHasFilename ;
                    sh:datatype xsd:string ;
                    sh:pattern  ".+\\.(zip|tar|gz|z|tgz|gzip|7z)$" ;
                    sh:flags    "i" ; # case insensitive
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  """
                                An ArchiveRepresentation requires a file with one of the following extensions
                                'zip', 'tar', 'gz', 'z', 'tgz', 'gzip', '7z'.
                                """ ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity sh:Violation ;
  sh:message     "ArchiveFileValue" .


###########################
# AudioRepresentation
###########################

api-shapes:hasAudioFileValue_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasAudioFileValue ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:message  "An AudioRepresentation requires a file with one of the following extensions 'mp3', 'wav'." .

api-shapes:AudioFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:AudioFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:fileValueHasFilename ;
                    sh:datatype xsd:string ;
                    sh:pattern  ".+\\.(mp3|wav)$" ;
                    sh:flags    "i" ; # case insensitive
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  "An AudioRepresentation requires a file with one of the following extensions 'mp3', 'wav'." ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity     sh:Violation ;
  sh:message      "AudioFileValue" .


###########################
# DocumentRepresentation
###########################

api-shapes:hasDocumentFileValue_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasDocumentFileValue ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:message  """
              A DocumentRepresentation requires a file with one of the following extensions
              'pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'.
              """ .

api-shapes:DocumentFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:DocumentFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:fileValueHasFilename ;
                    sh:datatype xsd:string ;
                    sh:pattern  ".+\\.(pdf|doc|docx|xls|xlsx|ppt|pptx)$" ;
                    sh:flags    "i" ; # case insensitive
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  """
                                A DocumentRepresentation requires a file with one of the following extensions
                                'pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'.
                                """ ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity     sh:Violation ;
  sh:message      "DocumentFileValue" .


###########################
# MovingImageRepresentation
###########################

api-shapes:hasMovingImageFileValue_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasMovingImageFileValue ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:message  "A MovingImageRepresentation requires a file with the extension 'mp4'." .

api-shapes:MovingImageFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:MovingImageFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:fileValueHasFilename ;
                    sh:datatype xsd:string ;
                    sh:pattern  ".+\\.mp4$" ;
                    sh:flags    "i" ; # case insensitive
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  "A MovingImageRepresentation requires a file with the extension 'mp4'." ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity     sh:Violation ;
  sh:message      "MovingImageFileValue" .


###########################
# StillImageRepresentation
###########################

api-shapes:hasStillImageFileValue_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasStillImageFileValue ;
  sh:xone     (
                [ sh:node api-shapes:StillImageFileValue_ClassShape ]
                [ sh:node api-shapes:StillImageExternalFileValue_ClassShape ]
              ) ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:message  """
              A StillImageRepresentation requires an external IIIF-URI or a file with one of the extensions:
              'jpg', 'jpeg', 'png', 'tif', 'tiff', 'jp2'.
              """ .

###
# StillImageFileValue

api-shapes:StillImageFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:StillImageFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:fileValueHasFilename ;
                    sh:datatype xsd:string ;
                    sh:pattern  ".+\\.(jpg|jpeg|png|tif|tiff|jp2|jpx)$" ; # jpx is the extension of the files returned by dsp-ingest
                    sh:flags    "i" ; # case insensitive
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  """
                                A StillImageFileValue requires a file with one of the extensions:
                                'jpg', 'jpeg', 'png', 'tif', 'tiff', 'jp2'.
                                """ ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity     sh:Violation ;
  sh:message     "StillImageFileValue" .


###
# StillImageExternalFileValue

api-shapes:StillImageExternalFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:StillImageExternalFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:stillImageFileValueHasExternalUrl ;
                    sh:datatype xsd:anyURI ;
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  "StillImageExternalFileValue requires an external IIIF-URI" ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity     sh:Violation ;
  sh:message      "StillImageExternalFileValue" .


###########################
# TextRepresentation
###########################

api-shapes:hasTextFileValue_PropShape
  a           sh:PropertyShape ;
  sh:path     knora-api:hasTextFileValue ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:message  """
              A TextRepresentation requires a file with one of the following extensions
              'odd', 'rng', 'txt', 'xml', 'xsd', 'xsl', 'csv', 'json'.
              """ .

api-shapes:TextFileValue_ClassShape
  a              sh:NodeShape ;
  sh:name        "Validates the class type" ;
  sh:targetClass knora-api:TextFileValue ;
  sh:property    [
                    a           sh:PropertyShape ;
                    sh:path     knora-api:fileValueHasFilename ;
                    sh:datatype xsd:string ;
                    sh:pattern  ".+\\.(odd|rng|txt|xml|xsd|xsl|csv|json)$" ;
                    sh:flags    "i" ; # case insensitive
                    sh:minCount 1 ;
                    sh:maxCount 1 ;
                    sh:severity sh:Violation ;
                    sh:message  """
                                A TextRepresentation requires a file with one of the following extensions
                                'odd', 'rng', 'txt', 'xml', 'xsd', 'xsl', 'csv', 'json'.
                                """ ;
                  ] ,
                  api-shapes:hasPermissions_Cardinality ,
                  api-shapes:hasLicense_PropShape ,
                  api-shapes:hasAuthorship_PropShape ,
                  api-shapes:hasCopyrightHolder_PropShape ;
  sh:severity     sh:Violation ;
  sh:message      "TextFileValue" .
